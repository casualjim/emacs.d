#!/bin/bash
set -f

ENSIME_BIN="`dirname \"$0\"`"              # relative bin path
ENSIME_HOME="`( cd \"$ENSIME_BIN/../\" && pwd )`"  # absolutized and normalized
ENSIME_LIB="$ENSIME_HOME/lib"
 
case "$1" in
  -h|--help|"")
    echo "$0 should be run by emacs plugin. M-x ensime should start the server for you"
    exit 1
  ;;
  *)
    PORT_FILE=$1
  ;;
esac

if [ "$ENSIME_JVM_ARGS" == "" ]
then
  ENSIME_JVM_ARGS="-Xms256M -Xmx1024M -Dfile.encoding=UTF-8"
fi

CLASSPATH=$ENSIME_LIB/ant-1.6.5.jar:$ENSIME_LIB/ant-1.8.1.jar:$ENSIME_LIB/ant-launcher-1.8.1.jar:$ENSIME_LIB/asm-3.2.jar:$ENSIME_LIB/asm-commons-3.2.jar:$ENSIME_LIB/asm-tree-3.2.jar:$ENSIME_LIB/backport-util-concurrent-3.1.jar:$ENSIME_LIB/classworlds-1.1-alpha-2.jar:$ENSIME_LIB/critbit-0.0.4.jar:$ENSIME_LIB/ensime_2.9.0-1-0.6.0.jar:$ENSIME_LIB/ivy-2.1.0.jar:$ENSIME_LIB/maven-ant-tasks-2.1.0.jar:$ENSIME_LIB/maven-artifact-2.2.1.jar:$ENSIME_LIB/maven-artifact-manager-2.2.1.jar:$ENSIME_LIB/maven-error-diagnostics-2.2.1.jar:$ENSIME_LIB/maven-model-2.2.1.jar:$ENSIME_LIB/maven-plugin-registry-2.2.1.jar:$ENSIME_LIB/maven-profile-2.2.1.jar:$ENSIME_LIB/maven-project-2.2.1.jar:$ENSIME_LIB/maven-repository-metadata-2.2.1.jar:$ENSIME_LIB/maven-settings-2.2.1.jar:$ENSIME_LIB/nekohtml-1.9.6.2.jar:$ENSIME_LIB/org.eclipse.jdt.core-3.6.0.v_A58.jar:$ENSIME_LIB/org.scala-refactoring_2.9.0-0.3.0-SNAPSHOT.jar:$ENSIME_LIB/plexus-container-default-1.0-alpha-9-stable-1.jar:$ENSIME_LIB/plexus-interpolation-1.11.jar:$ENSIME_LIB/plexus-utils-1.5.15.jar:$ENSIME_LIB/scala-compiler.jar:$ENSIME_LIB/scala-library.jar:$ENSIME_LIB/scalariform_2.9.0-0.1.0-SNAPSHOT.jar:$ENSIME_LIB/scalariform_2.9.0-1-0.1.1-SNAPSHOT.jar:$ENSIME_LIB/wagon-file-1.0-beta-6.jar:$ENSIME_LIB/wagon-http-lightweight-1.0-beta-6.jar:$ENSIME_LIB/wagon-http-shared-1.0-beta-6.jar:$ENSIME_LIB/wagon-provider-api-1.0-beta-6.jar:$ENSIME_LIB/xercesMinimal-1.9.6.2.jar
CMD="java -classpath ${CLASSPATH} ${ENSIME_JVM_ARGS} org.ensime.server.Server ${PORT_FILE}"
echo $CMD
$CMD

